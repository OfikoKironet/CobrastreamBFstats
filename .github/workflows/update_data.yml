name: Automatick치 aktualizace statistik (Playwright)

on:
  # Spust칤 se denn캩 o p콢lnoci UTC (co odpov칤d치 1:00 nebo 2:00 r치no SE캛/SEL캛)
  schedule:
    - cron: '0 0 * * *'
  # Umo쬹칤 ru캜n칤 spu코t캩n칤 z GitHub Actions z치lo쬶y
  workflow_dispatch:

jobs:
  fetch-and-update:
    # Pou쬴jeme standardn칤 virtu치ln칤 stroj
    runs-on: ubuntu-latest
    
    steps:
    
    # 1. St치hnut칤 k칩du repozit치콏e
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        # Pot콏ebn칠 pro fin치ln칤 commit zm캩n
        token: ${{ secrets.GITHUB_TOKEN }} 

    # 2. Nastaven칤 Pythonu
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.x' 

    # 3. Instalace z치vislost칤 Pythonu (requests, playwright)
    - name: Install Python dependencies
      run: pip install -r requirements.txt
      
    # 4. Instalace syst칠mov칳ch z치vislost칤 pro Playwright
    # Tento krok je kl칤캜ov칳 pro headless prohl칤쬰캜e na Ubuntu
    - name: Install Playwright system dependencies
      run: sudo apt-get update && sudo apt-get install -y libnss3 libnspr4 libdbus-1-3 libevent-core-2.1-7 libevent-pthreads-2.1-7 libfontconfig1 libglib2.0-0 libgtk-3-0 libatk1.0-0 libgdk-pixbuf2.0-0 libnotify4 libxtst6 libxkbcommon-x11-0 libxrandr2 libxi6

    # 5. Instalace samotn칠ho prohl칤쬰캜e Firefox
    - name: Install Playwright browser (Firefox)
      # V k칩du fetch_data.py pou쮂셨치me Firefox pro sn칤쬰n칤 detekce
      run: playwright install firefox
      
    # 6. Spu코t캩n칤 stahovac칤ho skriptu
    - name: Run data fetching script (using Playwright/Firefox)
      run: python fetch_data.py

    # 7. Commit a push zm캩n do repozit치콏e
    - name: Commit and push changes
      uses: stefanzweifel/git-auto-commit-action@v5
      with:
        commit_message: '游뱄 Automatick치 aktualizace dat z API (Playwright)'
        # Ulo쮂 pouze nov캩 sta쬰n칳 soubor data.json
        files: 'data.json'
        # Nastaven칤 jm칠na a emailu pro commit
        commit_user_name: 'GitHub Actions Bot'
        commit_user_email: 'actions@github.com'
